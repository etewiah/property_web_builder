<div class="container">
  <div class="row justify-content-center">
    <div class="col-md-6 col-lg-5">
      <div class="card shadow-sm mt-5">
        <div class="card-body p-4">
          <h3 class="text-center mb-4">Reset Password</h3>
          
          <div id="reset-form">
            <p class="text-muted">Enter your email address and we'll send you a link to reset your password.</p>
            
            <div class="form-group mb-3">
              <label for="email">Email Address</label>
              <input type="email" class="form-control" id="email" placeholder="Enter your email" required>
            </div>
            
            <button id="reset-button" class="btn btn-primary w-100">Send Reset Link</button>
            
            <div id="message" class="mt-3"></div>
          </div>
          
          <div class="text-center mt-3">
            <%= link_to "Back to Login", "/firebase_login", class: "text-decoration-none" %>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>

<script>
  // Firebase configuration
  const firebaseConfig = {
    apiKey: "<%= ENV['FIREBASE_API_KEY'] %>",
    authDomain: "<%= ENV['FIREBASE_PROJECT_ID'] %>.firebaseapp.com",
    projectId: "<%= ENV['FIREBASE_PROJECT_ID'] %>",
  };

  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();

  document.getElementById('reset-button').addEventListener('click', function() {
    const email = document.getElementById('email').value;
    const messageDiv = document.getElementById('message');
    const button = document.getElementById('reset-button');
    
    if (!email) {
      messageDiv.innerHTML = '<div class="alert alert-danger">Please enter your email address.</div>';
      return;
    }
    
    // Disable button and show loading
    button.disabled = true;
    button.innerHTML = 'Sending...';
    messageDiv.innerHTML = '';
    
    // Send password reset email
    auth.sendPasswordResetEmail(email)
      .then(function() {
        messageDiv.innerHTML = '<div class="alert alert-success">Password reset email sent! Please check your inbox.</div>';
        document.getElementById('email').value = '';
        button.innerHTML = 'Send Reset Link';
        button.disabled = false;
      })
      .catch(function(error) {
        let errorMessage = 'An error occurred. Please try again.';
        
        switch(error.code) {
          case 'auth/invalid-email':
            errorMessage = 'Invalid email address.';
            break;
          case 'auth/user-not-found':
            errorMessage = 'No account found with this email address.';
            break;
          default:
            errorMessage = error.message;
        }
        
        messageDiv.innerHTML = '<div class="alert alert-danger">' + errorMessage + '</div>';
        button.innerHTML = 'Send Reset Link';
        button.disabled = false;
      });
  });
  
  // Allow Enter key to submit
  document.getElementById('email').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
      document.getElementById('reset-button').click();
    }
  });
</script>
