<%
# Social Sharing Component
#
# Usage:
#   render 'pwb/shared/social_sharing', url: request.original_url, title: @property_details.title
#
# Options:
#   url:        (required) The URL to share
#   title:      (required) The title/text to share
#   icon_style: :fontawesome (default) or :phosphor
#   style:      :default (centered, border-top) or :bologna (left-aligned, no border)
#   networks:   Array of networks to show (default: [:facebook, :linkedin, :twitter, :whatsapp])
%>
<% url ||= request.original_url %>
<% title ||= '' %>
<% icon_style ||= :fontawesome %>
<% style ||= :default %>
<% networks ||= [:facebook, :linkedin, :twitter, :whatsapp] %>

<% encoded_url = ERB::Util.url_encode(url) %>
<% encoded_title = ERB::Util.url_encode(title) %>
<% encoded_both = ERB::Util.url_encode(title + ' ' + url) %>

<%
  # Define share URLs
  # Facebook: sharer.php accepts 'u' for URL and 'quote' for text (though FB primarily uses OG meta tags)
  # LinkedIn: shareArticle endpoint supports title/summary; mini=true is required
  # Twitter: intent/tweet accepts 'url' and 'text'
  # WhatsApp: wa.me accepts 'text' with message content
  share_urls = {
    facebook: "https://www.facebook.com/sharer/sharer.php?u=#{encoded_url}&quote=#{encoded_title}",
    linkedin: "https://www.linkedin.com/shareArticle?mini=true&url=#{encoded_url}&title=#{encoded_title}",
    twitter: "https://twitter.com/intent/tweet?url=#{encoded_url}&text=#{encoded_title}",
    whatsapp: "https://wa.me/?text=#{encoded_both}"
  }

  # Define icons based on style
  if icon_style == :phosphor
    icons = {
      facebook: 'ph ph-facebook-logo',
      linkedin: 'ph ph-linkedin-logo',
      twitter: 'ph ph-x-logo',
      whatsapp: 'ph ph-whatsapp-logo'
    }
  else
    icons = {
      facebook: 'fa fa-fw fa-facebook',
      linkedin: 'fa fa-fw fa-linkedin',
      twitter: 'fa fa-fw fa-twitter',
      whatsapp: 'fa fa-fw fa-whatsapp'
    }
  end

  # Define link classes based on style
  if style == :bologna
    link_classes = {
      facebook: 'w-10 h-10 flex items-center justify-center bg-blue-100 text-blue-600 rounded-full hover:bg-blue-600 hover:text-white transition-all duration-300',
      linkedin: 'w-10 h-10 flex items-center justify-center bg-blue-100 text-blue-700 rounded-full hover:bg-blue-700 hover:text-white transition-all duration-300',
      twitter: 'w-10 h-10 flex items-center justify-center bg-sky-100 text-sky-500 rounded-full hover:bg-sky-500 hover:text-white transition-all duration-300',
      whatsapp: 'w-10 h-10 flex items-center justify-center bg-green-100 text-green-600 rounded-full hover:bg-green-600 hover:text-white transition-all duration-300'
    }
    icon_classes = {}
  else
    link_classes = {
      facebook: 'w-8 h-8 flex items-center justify-center',
      linkedin: 'w-8 h-8 flex items-center justify-center',
      twitter: 'w-8 h-8 flex items-center justify-center',
      whatsapp: 'w-8 h-8 flex items-center justify-center'
    }
    icon_classes = {
      facebook: 'text-2xl text-blue-600 hover:text-blue-800 cursor-pointer',
      linkedin: 'text-2xl text-blue-700 hover:text-blue-900 cursor-pointer',
      twitter: 'text-2xl text-blue-400 hover:text-blue-600 cursor-pointer',
      whatsapp: 'text-2xl text-green-600 hover:text-green-800 cursor-pointer'
    }
  end

  # Define titles
  titles = {
    facebook: 'Share on Facebook',
    linkedin: 'Share on LinkedIn',
    twitter: 'Share on Twitter',
    whatsapp: 'Share on WhatsApp'
  }
%>

<% container_class = style == :bologna ? 'flex items-center gap-3' : 'flex justify-center gap-4 py-6 border-t border-gray-100' %>

<div class="<%= container_class %>">
  <% networks.each do |network| %>
    <a href="<%= share_urls[network] %>"
       target="_blank"
       rel="noopener noreferrer"
       title="<%= titles[network] %>"
       class="<%= link_classes[network] %>">
      <i class="<%= icons[network] %> <%= icon_classes[network] %>"></i>
    </a>
  <% end %>
</div>
