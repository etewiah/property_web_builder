<div class="max-w-7xl mx-auto">
  <div class="mb-6 flex justify-between items-center">
    <div>
      <h1 class="text-3xl font-bold text-gray-900"><%= @category.titleize %></h1>
      <p class="mt-2 text-gray-600">Manage <%= @category.humanize.downcase %> for your properties</p>
    </div>
    <button 
      onclick="document.getElementById('new-entry-form').classList.toggle('hidden')"
      class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center">
      <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
      </svg>
      Add New Entry
    </button>
  </div>

  <!-- Tab Navigation -->
  <%= render 'tab_navigation', current_category: @category %>

  <!-- New Entry Form (Hidden by default) -->
  <div id="new-entry-form" class="hidden mb-6 bg-white rounded-lg shadow p-6">
    <h3 class="text-lg font-semibold text-gray-900 mb-4">Add New <%= @category.titleize.singularize %></h3>
    <%= render 'form', field_key: Pwb::FieldKey.new, category: @category %>
  </div>

  <!-- Existing Entries Table -->
  <div class="bg-white rounded-lg shadow overflow-hidden">
    <table class="min-w-full divide-y divide-gray-200">
      <thead class="bg-gray-50">
        <tr>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Key</th>
          <% I18n.available_locales.each do |locale| %>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
              <%= locale.to_s.upcase %>
            </th>
          <% end %>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Order</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Visible</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
        </tr>
      </thead>
      <tbody class="bg-white divide-y divide-gray-200">
        <% if @field_keys.any? %>
          <% @field_keys.each do |field_key| %>
            <tr id="field-key-<%= field_key.global_key.parameterize %>">
              <td class="px-6 py-4 text-sm font-mono text-gray-500 max-w-xs truncate">
                <%= field_key.global_key.split('.').last %>
              </td>
              <% I18n.available_locales.each do |locale| %>
                <td class="px-6 py-4 text-sm text-gray-900">
                  <%= I18n.t(field_key.global_key, locale: locale, default: '') %>
                </td>
              <% end %>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                <%= field_key.sort_order || 0 %>
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full <%= field_key.visible? ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800' %>">
                  <%= field_key.visible? ? 'Yes' : 'No' %>
                </span>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm">
                <button 
                  onclick="toggleEditForm('<%= field_key.global_key.parameterize %>'); return false;"
                  class="text-blue-600 hover:text-blue-800 mr-3">
                  Edit
                </button>
                <%= button_to 'Delete',
                    site_admin_properties_settings_category_path(@category, field_key.global_key),
                    method: :delete,
                    data: { confirm: 'Are you sure? This will affect all properties using this setting.' },
                    class: 'text-red-600 hover:text-red-800' %>
              </td>
            </tr>
            <!-- Inline Edit Form (Hidden) -->
            <tr id="edit-form-<%= field_key.global_key.parameterize %>" class="hidden">
              <td colspan="<%= I18n.available_locales.size + 4 %>" class="px-6 py-4 bg-gray-50">
                <h3 class="text-lg font-semibold text-gray-900 mb-4">Edit <%= @category.titleize.singularize %></h3>
                <%= render 'form', field_key: field_key, category: @category %>
              </td>
            </tr>
          <% end %>
        <% else %>
          <tr>
            <td colspan="<%= I18n.available_locales.size + 4 %>" class="px-6 py-12 text-center">
              <svg class="mx-auto h-12 w-12 text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"></path>
              </svg>
              <p class="text-gray-500 text-lg mb-2">No <%= @category.humanize.downcase %> yet</p>
              <p class="text-gray-400">Click "Add New Entry" to create one</p>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
</div>

<script>
  function toggleEditForm(id) {
    const editRow = document.getElementById(`edit-form-${id}`);
    const isHidden = editRow.classList.contains('hidden');
    
    // Hide all other edit forms
    document.querySelectorAll('[id^="edit-form-"]').forEach(row => {
      row.classList.add('hidden');
    });
    
    // Toggle this one
    if (isHidden) {
      editRow.classList.remove('hidden');
    }
  }
</script>
