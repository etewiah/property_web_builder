<div class="max-w-6xl mx-auto">
  <%= render 'header' %>
  <div class="bg-white rounded-lg shadow overflow-hidden">
    <%= render 'navigation', current_tab: 'sale_rental' %>
    <div class="p-6">
      <div class="mb-6 p-4 bg-blue-50 border border-blue-200 rounded-md">
        <p class="text-sm text-blue-700">
          <strong>Note:</strong> Sale and Rental listings are separate entities.
          A property can have both a sale listing and a rental listing simultaneously.
          Toggle <strong>Visible</strong> to publish a listing on your website.
        </p>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <!-- Sale Listing Section -->
        <div class="border border-gray-200 rounded-lg p-6">
          <h3 class="text-xl font-bold text-gray-900 mb-4 flex items-center">
            <span class="bg-green-100 text-green-800 text-xs font-semibold px-2.5 py-0.5 rounded mr-2">FOR SALE</span>
            Sale Listing
          </h3>

          <%= form_with model: @sale_listing, url: site_admin_prop_path(@prop), method: :patch, local: true, scope: :sale_listing do |f| %>
            <div class="space-y-4">
              <!-- Visibility Flags -->
              <div class="grid grid-cols-2 gap-4">
                <div class="flex items-center">
                  <%= f.check_box :visible, class: "h-4 w-4 text-green-600 focus:ring-green-500 border-gray-300 rounded" %>
                  <label class="ml-2 block text-sm text-gray-900">Visible</label>
                </div>
                <div class="flex items-center">
                  <%= f.check_box :highlighted, class: "h-4 w-4 text-green-600 focus:ring-green-500 border-gray-300 rounded" %>
                  <label class="ml-2 block text-sm text-gray-900">Highlighted</label>
                </div>
                <div class="flex items-center">
                  <%= f.check_box :reserved, class: "h-4 w-4 text-yellow-600 focus:ring-yellow-500 border-gray-300 rounded" %>
                  <label class="ml-2 block text-sm text-gray-900">Reserved</label>
                </div>
                <div class="flex items-center">
                  <%= f.check_box :archived, class: "h-4 w-4 text-gray-600 focus:ring-gray-500 border-gray-300 rounded" %>
                  <label class="ml-2 block text-sm text-gray-900">Archived</label>
                </div>
                <div class="flex items-center">
                  <%= f.check_box :furnished, class: "h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded" %>
                  <label class="ml-2 block text-sm text-gray-900">Furnished</label>
                </div>
              </div>

              <!-- Pricing -->
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Sale Price</label>
                <div class="flex space-x-2">
                  <%= f.number_field :price_sale_current_cents,
                      value: @sale_listing.price_sale_current_cents.to_i > 0 ? @sale_listing.price_sale_current_cents / 100.0 : nil,
                      step: 0.01, min: 0,
                      class: "flex-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-green-500 focus:border-green-500 sm:text-sm",
                      placeholder: "Enter price..." %>
                  <%= f.select :price_sale_current_currency,
                      [['EUR', 'EUR'], ['USD', 'USD'], ['GBP', 'GBP']],
                      { selected: @sale_listing.price_sale_current_currency || 'EUR' },
                      class: "w-24 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-green-500 focus:border-green-500 sm:text-sm" %>
                </div>
              </div>

              <!-- Commission -->
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Commission</label>
                <div class="flex space-x-2">
                  <%= f.number_field :commission_cents,
                      value: @sale_listing.commission_cents.to_i > 0 ? @sale_listing.commission_cents / 100.0 : nil,
                      step: 0.01, min: 0,
                      class: "flex-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-green-500 focus:border-green-500 sm:text-sm",
                      placeholder: "Enter commission..." %>
                  <%= f.select :commission_currency,
                      [['EUR', 'EUR'], ['USD', 'USD'], ['GBP', 'GBP']],
                      { selected: @sale_listing.commission_currency || 'EUR' },
                      class: "w-24 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-green-500 focus:border-green-500 sm:text-sm" %>
                </div>
              </div>

              <div class="pt-4">
                <%= f.submit @sale_listing.persisted? ? 'Update Sale Listing' : 'Create Sale Listing',
                    class: 'w-full px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-green-600 hover:bg-green-700 cursor-pointer' %>
              </div>
            </div>
          <% end %>
        </div>

        <!-- Rental Listing Section -->
        <div class="border border-gray-200 rounded-lg p-6">
          <h3 class="text-xl font-bold text-gray-900 mb-4 flex items-center">
            <span class="bg-purple-100 text-purple-800 text-xs font-semibold px-2.5 py-0.5 rounded mr-2">FOR RENT</span>
            Rental Listing
          </h3>

          <%= form_with model: @rental_listing, url: site_admin_prop_path(@prop), method: :patch, local: true, scope: :rental_listing do |f| %>
            <div class="space-y-4">
              <!-- Visibility Flags -->
              <div class="grid grid-cols-2 gap-4">
                <div class="flex items-center">
                  <%= f.check_box :visible, class: "h-4 w-4 text-purple-600 focus:ring-purple-500 border-gray-300 rounded" %>
                  <label class="ml-2 block text-sm text-gray-900">Visible</label>
                </div>
                <div class="flex items-center">
                  <%= f.check_box :highlighted, class: "h-4 w-4 text-purple-600 focus:ring-purple-500 border-gray-300 rounded" %>
                  <label class="ml-2 block text-sm text-gray-900">Highlighted</label>
                </div>
                <div class="flex items-center">
                  <%= f.check_box :reserved, class: "h-4 w-4 text-yellow-600 focus:ring-yellow-500 border-gray-300 rounded" %>
                  <label class="ml-2 block text-sm text-gray-900">Reserved</label>
                </div>
                <div class="flex items-center">
                  <%= f.check_box :archived, class: "h-4 w-4 text-gray-600 focus:ring-gray-500 border-gray-300 rounded" %>
                  <label class="ml-2 block text-sm text-gray-900">Archived</label>
                </div>
                <div class="flex items-center">
                  <%= f.check_box :furnished, class: "h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded" %>
                  <label class="ml-2 block text-sm text-gray-900">Furnished</label>
                </div>
              </div>

              <!-- Rental Type -->
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Rental Type</label>
                <div class="flex space-x-4">
                  <div class="flex items-center">
                    <%= f.check_box :for_rent_short_term, class: "h-4 w-4 text-purple-600 focus:ring-purple-500 border-gray-300 rounded" %>
                    <label class="ml-2 block text-sm text-gray-900">Short Term</label>
                  </div>
                  <div class="flex items-center">
                    <%= f.check_box :for_rent_long_term, class: "h-4 w-4 text-purple-600 focus:ring-purple-500 border-gray-300 rounded" %>
                    <label class="ml-2 block text-sm text-gray-900">Long Term</label>
                  </div>
                </div>
              </div>

              <!-- Monthly Rent -->
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Monthly Rent</label>
                <div class="flex space-x-2">
                  <%= f.number_field :price_rental_monthly_current_cents,
                      value: @rental_listing.price_rental_monthly_current_cents.to_i > 0 ? @rental_listing.price_rental_monthly_current_cents / 100.0 : nil,
                      step: 0.01, min: 0,
                      class: "flex-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-purple-500 focus:border-purple-500 sm:text-sm",
                      placeholder: "Enter monthly rent..." %>
                  <%= f.select :price_rental_monthly_current_currency,
                      [['EUR', 'EUR'], ['USD', 'USD'], ['GBP', 'GBP']],
                      { selected: @rental_listing.price_rental_monthly_current_currency || 'EUR' },
                      class: "w-24 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-purple-500 focus:border-purple-500 sm:text-sm" %>
                </div>
              </div>

              <!-- Seasonal Pricing (for short term rentals) -->
              <div class="grid grid-cols-2 gap-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Low Season</label>
                  <%= f.number_field :price_rental_monthly_low_season_cents,
                      value: @rental_listing.price_rental_monthly_low_season_cents.to_i > 0 ? @rental_listing.price_rental_monthly_low_season_cents / 100.0 : nil,
                      step: 0.01, min: 0,
                      class: "block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-purple-500 focus:border-purple-500 sm:text-sm",
                      placeholder: "Low season price..." %>
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">High Season</label>
                  <%= f.number_field :price_rental_monthly_high_season_cents,
                      value: @rental_listing.price_rental_monthly_high_season_cents.to_i > 0 ? @rental_listing.price_rental_monthly_high_season_cents / 100.0 : nil,
                      step: 0.01, min: 0,
                      class: "block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-purple-500 focus:border-purple-500 sm:text-sm",
                      placeholder: "High season price..." %>
                </div>
              </div>

              <div class="pt-4">
                <%= f.submit @rental_listing.persisted? ? 'Update Rental Listing' : 'Create Rental Listing',
                    class: 'w-full px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-purple-600 hover:bg-purple-700 cursor-pointer' %>
              </div>
            </div>
          <% end %>
        </div>
      </div>

      <!-- Back Link -->
      <div class="flex justify-start items-center mt-8 pt-6 border-t border-gray-200">
        <%= link_to '&larr; Back to Properties'.html_safe, site_admin_props_path, class: 'text-blue-600 hover:text-blue-800' %>
      </div>
    </div>
  </div>
</div>
