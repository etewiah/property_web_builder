<%= form_with model: @feature,
              url: @feature.persisted? ? site_admin_search_filters_feature_path(@feature) : site_admin_search_filters_features_path,
              scope: :search_filter_option,
              method: @feature.persisted? ? :patch : :post,
              local: true,
              class: "space-y-6" do |f| %>
  <% if @feature.errors.any? %>
    <div class="bg-red-50 border border-red-200 rounded-lg p-4">
      <div class="flex">
        <svg class="w-5 h-5 text-red-600 mt-0.5 mr-3 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
        </svg>
        <div>
          <h3 class="text-sm font-medium text-red-800">Please fix the following errors:</h3>
          <ul class="mt-2 text-sm text-red-700 list-disc list-inside">
            <% @feature.errors.full_messages.each do |message| %>
              <li><%= message %></li>
            <% end %>
          </ul>
        </div>
      </div>
    </div>
  <% end %>

  <!-- Basic Settings -->
  <div class="bg-white rounded-lg shadow">
    <div class="px-6 py-4 border-b border-gray-200">
      <h2 class="text-lg font-semibold text-gray-900">Basic Settings</h2>
    </div>
    <div class="px-6 py-4 space-y-4">
      <div>
        <%= f.label :global_key, "Key", class: "block text-sm font-medium text-gray-700" %>
        <%= f.text_field :global_key,
                         class: "mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 font-mono",
                         placeholder: "e.g., pool, garage, garden" %>
        <p class="mt-1 text-xs text-gray-500">
          Unique identifier (lowercase, hyphens allowed). Leave blank to auto-generate from name.
        </p>
      </div>

      <div>
        <%= f.label :external_code, "External Provider Code", class: "block text-sm font-medium text-gray-700" %>
        <%= f.text_field :external_code,
                         class: "mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 font-mono",
                         placeholder: "e.g., p_Pool, p_Garage" %>
        <p class="mt-1 text-xs text-gray-500">
          Maps to external feed provider's feature parameter name (e.g., Resales Online).
        </p>
      </div>

      <div class="grid grid-cols-2 gap-4">
        <div>
          <%= f.label :category, class: "block text-sm font-medium text-gray-700" %>
          <%= f.text_field :category,
                           value: @feature.category,
                           class: "mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500",
                           placeholder: "e.g., Outdoor, Interior" %>
          <p class="mt-1 text-xs text-gray-500">
            Optional category to group features.
          </p>
        </div>

        <div>
          <%= f.label :icon, class: "block text-sm font-medium text-gray-700" %>
          <%= f.text_field :icon,
                           class: "mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500",
                           placeholder: "e.g., fa-swimming-pool" %>
          <p class="mt-1 text-xs text-gray-500">
            Optional icon class.
          </p>
        </div>
      </div>

      <div>
        <%= f.label :param_name, "API Parameter Name", class: "block text-sm font-medium text-gray-700" %>
        <%= f.text_field :param_name,
                         value: @feature.feature_param_name,
                         class: "mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 font-mono",
                         placeholder: "e.g., p_Pool" %>
        <p class="mt-1 text-xs text-gray-500">
          External API parameter name for querying (if different from external code).
        </p>
      </div>
    </div>
  </div>

  <!-- Translations -->
  <div class="bg-white rounded-lg shadow">
    <div class="px-6 py-4 border-b border-gray-200">
      <h2 class="text-lg font-semibold text-gray-900">Labels</h2>
      <p class="mt-1 text-sm text-gray-500">Enter the display name for each language.</p>
    </div>
    <div class="px-6 py-4 space-y-4">
      <% I18n.available_locales.first(6).each do |locale| %>
        <div>
          <%= f.label "label_#{locale}", locale_name(locale), class: "block text-sm font-medium text-gray-700" %>
          <%= f.text_field "label_#{locale}",
                           value: @feature.translations.dig(locale.to_s) || @feature.translations.dig(locale),
                           class: "mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500",
                           placeholder: "e.g., Swimming Pool, Piscina" %>
        </div>
      <% end %>
    </div>
  </div>

  <!-- Visibility Options -->
  <div class="bg-white rounded-lg shadow">
    <div class="px-6 py-4 border-b border-gray-200">
      <h2 class="text-lg font-semibold text-gray-900">Visibility</h2>
    </div>
    <div class="px-6 py-4 space-y-4">
      <div class="flex items-center">
        <%= f.check_box :visible, class: "h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded" %>
        <%= f.label :visible, class: "ml-2 text-sm text-gray-700" do %>
          <span class="font-medium">Visible</span>
          <span class="text-gray-500 ml-1">(Show this feature in property listings)</span>
        <% end %>
      </div>

      <div class="flex items-center">
        <%= f.check_box :show_in_search, class: "h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded" %>
        <%= f.label :show_in_search, class: "ml-2 text-sm text-gray-700" do %>
          <span class="font-medium">Show in Search</span>
          <span class="text-gray-500 ml-1">(Include as a search filter checkbox)</span>
        <% end %>
      </div>
    </div>
  </div>

  <!-- Form Actions -->
  <div class="flex items-center justify-between pt-4">
    <div>
      <% if @feature.persisted? %>
        <%= button_to "Delete",
                      site_admin_search_filters_feature_path(@feature),
                      method: :delete,
                      class: "text-red-600 hover:text-red-800 text-sm",
                      form: { data: { turbo_confirm: "Are you sure you want to delete this feature?" } } %>
      <% end %>
    </div>
    <div class="flex space-x-3">
      <%= link_to "Cancel", site_admin_search_filters_features_path, class: "px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50" %>
      <%= f.submit @feature.persisted? ? "Update Feature" : "Create Feature",
                   class: "px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 cursor-pointer" %>
    </div>
  </div>
<% end %>
