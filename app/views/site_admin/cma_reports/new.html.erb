<div class="max-w-3xl mx-auto">
  <!-- Breadcrumb -->
  <nav class="mb-4 text-sm">
    <%= link_to "CMA Reports", site_admin_cma_reports_path, class: "text-blue-600 hover:text-blue-800" %> /
    <span class="text-gray-500">Generate Report</span>
  </nav>

  <!-- Page Header -->
  <div class="mb-6">
    <h1 class="text-3xl font-bold text-gray-900">Generate CMA Report</h1>
    <p class="mt-2 text-gray-600">
      Create a Comparative Market Analysis report for a property.
    </p>
  </div>

  <%= form_with model: @report, url: site_admin_cma_reports_path, local: true, class: "space-y-6" do |f| %>
    <!-- Property Selection -->
    <div class="bg-white rounded-lg shadow p-6">
      <h2 class="text-lg font-semibold text-gray-900 mb-4">Subject Property</h2>
      <p class="text-sm text-gray-500 mb-4">
        Select the property you want to analyze. The CMA will find comparable properties in the area.
      </p>

      <% if @properties.any? %>
        <div class="space-y-4">
          <div>
            <label for="cma_report_property_id" class="block text-sm font-medium text-gray-700 mb-2">
              Select Property <span class="text-red-500">*</span>
            </label>
            <select name="cma_report[property_id]" id="cma_report_property_id"
                    class="block w-full py-2 px-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500"
                    required>
              <option value="">Choose a property...</option>
              <% @properties.each do |property| %>
                <option value="<%= property.id %>">
                  <%= property.street_address %>
                  <% if property.city.present? %>(<%= property.city %>)<% end %>
                  - <%= property.count_bedrooms || 0 %> bed / <%= property.count_bathrooms || 0 %> bath
                </option>
              <% end %>
            </select>
          </div>
        </div>
      <% else %>
        <div class="text-center py-8 bg-gray-50 rounded-lg">
          <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
          </svg>
          <h3 class="mt-4 text-sm font-medium text-gray-900">No properties available</h3>
          <p class="mt-2 text-sm text-gray-500">Add some properties to your listings first.</p>
          <div class="mt-4">
            <%= link_to new_site_admin_prop_path, class: "inline-flex items-center px-4 py-2 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 transition-colors" do %>
              Add Property
            <% end %>
          </div>
        </div>
      <% end %>
    </div>

    <!-- Analysis Options -->
    <div class="bg-white rounded-lg shadow p-6">
      <h2 class="text-lg font-semibold text-gray-900 mb-4">Analysis Options</h2>
      <p class="text-sm text-gray-500 mb-4">
        Customize the parameters for finding comparable properties.
      </p>

      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div>
          <label for="cma_report_radius_km" class="block text-sm font-medium text-gray-700 mb-2">
            Search Radius
          </label>
          <select name="cma_report[radius_km]" id="cma_report_radius_km"
                  class="block w-full py-2 px-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
            <option value="1">1 km</option>
            <option value="2" selected>2 km (Recommended)</option>
            <option value="5">5 km</option>
            <option value="10">10 km</option>
          </select>
          <p class="mt-1 text-xs text-gray-500">How far to search for comparables</p>
        </div>

        <div>
          <label for="cma_report_months_back" class="block text-sm font-medium text-gray-700 mb-2">
            Time Period
          </label>
          <select name="cma_report[months_back]" id="cma_report_months_back"
                  class="block w-full py-2 px-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
            <option value="3">Last 3 months</option>
            <option value="6" selected>Last 6 months (Recommended)</option>
            <option value="12">Last 12 months</option>
          </select>
          <p class="mt-1 text-xs text-gray-500">How far back to look for sales</p>
        </div>

        <div>
          <label for="cma_report_max_comparables" class="block text-sm font-medium text-gray-700 mb-2">
            Max Comparables
          </label>
          <select name="cma_report[max_comparables]" id="cma_report_max_comparables"
                  class="block w-full py-2 px-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
            <option value="5">5 properties</option>
            <option value="10" selected>10 properties (Recommended)</option>
            <option value="15">15 properties</option>
          </select>
          <p class="mt-1 text-xs text-gray-500">Maximum comparables to include</p>
        </div>
      </div>
    </div>

    <!-- Report Details -->
    <div class="bg-white rounded-lg shadow p-6">
      <h2 class="text-lg font-semibold text-gray-900 mb-4">Report Details</h2>

      <div>
        <label for="cma_report_title" class="block text-sm font-medium text-gray-700 mb-2">
          Custom Title (Optional)
        </label>
        <input type="text" name="cma_report[title]" id="cma_report_title"
               class="block w-full py-2 px-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500"
               placeholder="Leave blank for auto-generated title">
        <p class="mt-1 text-xs text-gray-500">
          If left blank, title will be "CMA Report for [Property Address]"
        </p>
      </div>
    </div>

    <!-- What's Included -->
    <div class="bg-blue-50 rounded-lg p-6">
      <h3 class="text-sm font-semibold text-blue-900 mb-3">What's included in the CMA:</h3>
      <ul class="grid grid-cols-1 md:grid-cols-2 gap-2 text-sm text-blue-800">
        <li class="flex items-center">
          <svg class="w-4 h-4 mr-2 text-blue-600" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
          </svg>
          Comparable property analysis
        </li>
        <li class="flex items-center">
          <svg class="w-4 h-4 mr-2 text-blue-600" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
          </svg>
          Price adjustments
        </li>
        <li class="flex items-center">
          <svg class="w-4 h-4 mr-2 text-blue-600" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
          </svg>
          Market statistics
        </li>
        <li class="flex items-center">
          <svg class="w-4 h-4 mr-2 text-blue-600" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
          </svg>
          AI-powered insights
        </li>
        <li class="flex items-center">
          <svg class="w-4 h-4 mr-2 text-blue-600" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
          </svg>
          Suggested price range
        </li>
        <li class="flex items-center">
          <svg class="w-4 h-4 mr-2 text-blue-600" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
          </svg>
          Professional PDF report
        </li>
      </ul>
    </div>

    <!-- Actions -->
    <div class="flex items-center justify-between">
      <%= link_to "Cancel", site_admin_cma_reports_path, class: "text-gray-600 hover:text-gray-800" %>

      <% if @properties.any? %>
        <button type="submit" class="inline-flex items-center px-6 py-3 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 transition-colors">
          <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
          </svg>
          Generate CMA Report
        </button>
      <% end %>
    </div>
  <% end %>
</div>
