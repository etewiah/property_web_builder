// =============================================================================
// DEPRECATED: jQuery-based JavaScript
// =============================================================================
// This file contains legacy jQuery code that is being phased out.
// New features should use Stimulus.js controllers in app/javascript/controllers/
//
// Migration Status:
// - Search form AJAX handlers: MIGRATED to search_form_controller.js
// - Contact form handlers: MIGRATED to contact_form_controller.js  
// - Map initialization: MIGRATED to map_controller.js (using Leaflet)
// - INMOAPP.truncateDescriptions: MIGRATED to search_form_controller.js
// - INMOAPP.sortSearchResults: MIGRATED to search_form_controller.js
//
// TODO: Remove jQuery dependencies once all Vue components are migrated
// =============================================================================

//= require jquery
//= require jquery_ujs
//= require bootstrap-select
//= require lodash-4.17.15

<%# Vue.js removed - December 2024 %>

// =============================================================================
// DEPRECATED: Global namespace and jQuery handlers
// These are kept for backward compatibility with legacy Vue components
// =============================================================================

$(document).on('ready', function() {
  console.warn('[DEPRECATED] jQuery document.ready handler - use Stimulus controllers instead');
  INMOAPP.pageHolder = {};
});

var INMOAPP = INMOAPP || {};
INMOAPP.pageHolder = {};

// -----------------------------------------------------------------------------
// DEPRECATED: Google Maps functions (replaced by Leaflet + map_controller.js)
// -----------------------------------------------------------------------------

INMOAPP.showMap = function(currentItemForMap) {
  console.warn('[DEPRECATED] INMOAPP.showMap - use map_controller.js with Leaflet instead');
  if (typeof(INMOAPP.pageHolder.map) === "undefined") {
    INMOAPP.renderMap(currentItemForMap, "600px", true);
  } else {
    google.maps.event.addListener(INMOAPP.pageHolder.map, 'idle', function() {
      google.maps.event.trigger(INMOAPP.pageHolder.map, 'resize');
      var center = INMOAPP.pageHolder.map.getCenter();
      INMOAPP.pageHolder.map.setCenter(center);
    });
  }
};

INMOAPP.renderMap = function(currentItemForMap, minHeight, showMarker) {
  console.warn('[DEPRECATED] INMOAPP.renderMap - use map_controller.js with Leaflet instead');
  if ($("#inmo-map-canvas").length > 0) {
    var mapOptions = {
      scrollwheel: false,
      zoom: 15,
      styles: [{
        "featureType": "poi",
        "elementType": "labels",
        "stylers": [{ "visibility": "off" }]
      }]
    };
    mapOptions.mapTypeId = google.maps.MapTypeId.ROADMAP;

    if (minHeight) {
      $("#inmo-map-canvas").css("min-height", minHeight);
    }
    INMOAPP.pageHolder.map = new google.maps.Map(document.getElementById('inmo-map-canvas'), mapOptions);

    if (currentItemForMap && currentItemForMap.latitude) {
      var propertyLatLng = new google.maps.LatLng(
        parseFloat(currentItemForMap.latitude),
        parseFloat(currentItemForMap.longitude)
      );
      var formatted_address = currentItemForMap.street_address || "";
      if (showMarker) {
        INMOAPP.addMarker(propertyLatLng, formatted_address);
      }
      google.maps.event.addListener(INMOAPP.pageHolder.map, 'idle', function() {
        google.maps.event.trigger(INMOAPP.pageHolder.map, 'resize');
        INMOAPP.pageHolder.map.setCenter(propertyLatLng);
      });
    }
  }
};

INMOAPP.addMarker = function(latlng, formatted_address) {
  console.warn('[DEPRECATED] INMOAPP.addMarker - use map_controller.js with Leaflet instead');
  var newMarker = new google.maps.Marker({
    position: latlng,
    map: INMOAPP.pageHolder.map
  });
};

// -----------------------------------------------------------------------------
// DEPRECATED: Search result functions (replaced by search_form_controller.js)
// -----------------------------------------------------------------------------

INMOAPP.sortSearchResults = function() {
  console.warn('[DEPRECATED] INMOAPP.sortSearchResults - use search_form_controller.js instead');
  var $wrapper = $('#ordered-properties');
  if ($("#order-price-desc").hasClass("active")) {
    $wrapper.find('.property-item').sort(function(a, b) {
      return (parseInt(b.dataset.price) - parseInt(a.dataset.price));
    }).appendTo($wrapper);
  } else if ($("#order-price-asc").hasClass("active")) {
    $wrapper.find('.property-item').sort(function(a, b) {
      return (parseInt(a.dataset.price) - parseInt(b.dataset.price));
    }).appendTo($wrapper);
  }
};

INMOAPP.truncateDescriptions = function() {
  console.warn('[DEPRECATED] INMOAPP.truncateDescriptions - use search_form_controller.js instead');
  // Now handled by Stimulus controller
};
