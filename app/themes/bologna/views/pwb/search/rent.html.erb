<% page_title @page_title %>
<%= render 'pwb/shared/leaflet_assets' %>

<%# Bologna Theme - Rental Search Page %>
<%# Same clean design as buy page but with olive accent for rentals %>

<!-- Page Header -->
<section class="bg-gradient-to-br from-olive-50 via-white to-sand-50 border-b border-warm-gray-100">
  <div class="container mx-auto px-6 py-10">
    <div class="flex flex-col md:flex-row md:items-center md:justify-between">
      <div>
        <nav class="mb-4">
          <ol class="flex items-center space-x-2 text-sm">
            <li>
              <a href="<%= root_path %>" class="text-warm-gray-500 hover:text-olive-600 transition-colors">
                <i class="ph ph-house mr-1"></i>
                <%= t('pwb.breadcrumb.home', default: 'Home') %>
              </a>
            </li>
            <li class="text-warm-gray-400">
              <i class="ph ph-caret-right text-xs"></i>
            </li>
            <li class="text-warm-gray-900 font-medium">
              <%= t('pwb.breadcrumb.rent', default: 'Rent') %>
            </li>
          </ol>
        </nav>
        <h1 class="font-display text-3xl md:text-4xl font-bold text-warm-gray-900 mb-2">
          <%= t('searchForRentals', default: 'Properties for Rent') %>
        </h1>
        <p class="text-warm-gray-500">
          <%= t('pwb.search.find_rental', default: 'Find your perfect rental home') %>
        </p>
      </div>
      <div class="mt-6 md:mt-0">
        <span class="inline-flex items-center px-4 py-2 bg-olive-100 text-olive-600 rounded-pill text-sm font-medium">
          <i class="ph ph-key mr-2"></i>
          <%= t('pwb.search.for_rent', default: 'For Rent') %>
        </span>
      </div>
    </div>
  </div>
</section>

<!-- Main Content with Stimulus controller -->
<section class="bg-warm-gray-50" data-controller="search-form">
  <div class="container mx-auto px-6 py-10">
    <div class="search-layout flex flex-wrap -mx-4">
      <!-- Sidebar Filters - Desktop: always visible, Mobile: toggleable -->
      <aside class="search-sidebar w-full lg:w-1/4 px-4 mb-8 lg:mb-0">
        <!-- Mobile Filter Toggle -->
        <div class="filter-toggle lg:hidden mb-4">
          <button type="button"
                  data-action="search-form#toggleFilters"
                  data-search-form-target="filterToggle"
                  aria-expanded="false"
                  aria-controls="sidebar-filters"
                  class="w-full flex items-center justify-center px-6 py-3 bg-white text-warm-gray-700 font-medium rounded-soft shadow-soft hover:shadow-medium transition-all duration-300">
            <i class="ph ph-funnel mr-2 text-olive-500"></i>
            <%= t('filter', default: 'Filters') %>
            <i class="ph ph-caret-down ml-2"></i>
          </button>
        </div>

        <!-- Filter Panel - hidden on mobile, visible on desktop -->
        <div id="sidebar-filters"
             class="filter-content hidden lg:block"
             data-search-form-target="filterPanel">
          <div class="bg-white rounded-softer shadow-soft p-6 sticky top-28">
            <div class="flex items-center mb-6">
              <i class="ph ph-sliders text-olive-500 text-xl mr-3"></i>
              <h3 class="font-display font-semibold text-lg text-warm-gray-900">
                <%= t('pwb.search.filters', default: 'Filters') %>
              </h3>
            </div>
            <%= render '/pwb/search/search_form_for_rent' %>
          </div>
        </div>
      </aside>

      <!-- Results Column -->
      <main class="search-results w-full lg:w-3/4 px-4">
        <!-- Loading Spinner -->
        <div data-search-form-target="spinner" class="hidden">
          <div class="flex flex-col items-center justify-center py-16">
            <div class="w-16 h-16 border-4 border-olive-200 border-t-olive-500 rounded-full animate-spin mb-4"></div>
            <p class="text-warm-gray-500 font-medium"><%= t('pwb.search.loading', default: 'Loading properties...') %></p>
          </div>
        </div>

        <!-- Search Results Container -->
        <div id="inmo-search-results" data-search-form-target="results" class="transition-opacity duration-300">
          <%= render 'search_results' %>
        </div>
      </main>
    </div>
  </div>
</section>

<!-- Map Section with Stimulus controller -->
<% if @map_markers.length > 0 %>
  <section class="border-t border-warm-gray-200 bg-white">
    <div class="container mx-auto px-6 py-8">
      <div class="flex items-center mb-6">
        <span class="w-10 h-10 flex items-center justify-center bg-olive-100 rounded-full mr-3">
          <i class="ph ph-map-trifold text-olive-600"></i>
        </span>
        <h2 class="font-display text-xl font-bold text-warm-gray-900">
          <%= t('pwb.search.map_view', default: 'Map View') %>
        </h2>
      </div>
    </div>
    <div class="w-full" style="height: 500px;">
      <div id="search-map" 
           class="w-full h-full"
           data-controller="map"
           data-map-target="canvas"
           data-map-markers-value="<%= @map_markers.to_json %>">
      </div>
    </div>
  </section>
<% end %>
