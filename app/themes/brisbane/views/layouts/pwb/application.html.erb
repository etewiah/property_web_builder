<!DOCTYPE html>
<html lang="<%= I18n.locale %>">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="index, follow">
    <title><%= yield(:page_title) %></title>
    <%= favicon_tags %>
    <%= yield(:page_head) %>

    <%# Google Fonts - Luxury Typography %>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,500;0,600;1,400&family=Montserrat:wght@300;400;500;600&display=swap" rel="stylesheet">

    <%# Tailwind CSS %>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          container: {
            center: true,
            padding: '2rem',
          },
          extend: {
            colors: {
              // Brisbane Luxury Color Palette
              'luxury-navy': '#1a2744',
              'luxury-gold': '#c9a962',
              'luxury-cream': '#faf8f5',
              'luxury-charcoal': '#2d2d2d',
              'luxury-pearl': '#f5f3f0',
              primary: '#1a2744',
              secondary: '#c9a962',
            },
            fontFamily: {
              serif: ['Cormorant Garamond', 'Georgia', 'serif'],
              sans: ['Montserrat', 'Helvetica Neue', 'sans-serif'],
            },
            borderRadius: {
              DEFAULT: '0',
              'none': '0',
            },
            boxShadow: {
              'elegant': '0 4px 20px rgba(26, 39, 68, 0.08)',
              'hover': '0 8px 30px rgba(26, 39, 68, 0.12)',
            },
            letterSpacing: {
              'luxury': '0.15em',
              'wide-luxury': '0.25em',
            }
          }
        }
      }
    </script>

    <%# Flowbite for UI components %>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.3.0/flowbite.min.css" rel="stylesheet" />

    <%# Theme-specific styles %>
    <%= stylesheet_link_tag "brisbane_theme", media: "all" %>
    <style>
      <%= custom_styles "brisbane" %>
    </style>

    <%= javascript_include_tag "pwb/application", async: false %>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.3.0/flowbite.min.js"></script>
    <%= csrf_meta_tags %>

    <%# Leaflet for maps %>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

    <%# Font Awesome %>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" crossorigin="anonymous" />
  </head>

  <body class="tnt-body brisbane-theme <%= @current_website.body_style %> font-sans antialiased bg-luxury-cream text-luxury-charcoal">
    <!-- MAIN WRAPPER -->
    <div id="main-vue" class="body-wrap sticky-wrap <%= @current_website.body_style %> flex flex-col min-h-screen">

      <%# Elegant Header %>
      <%= render partial: '/pwb/header', locals: { not_devise: true } %>

      <%# Main Content %>
      <main class="sticky-body flex-grow">
        <%= render 'devise/shared/messages' %>
        <%= yield %>
      </main>

      <%# Sophisticated Footer %>
      <%= render partial: '/pwb/footer', locals: {} %>

      <%# Analytics %>
      <%= render partial: '/pwb/analytics', locals: {} %>
    </div>

    <script>
      // Navbar scroll effect for luxury feel
      document.addEventListener('DOMContentLoaded', function() {
        const navbar = document.querySelector('nav, header');
        if (navbar) {
          window.addEventListener('scroll', function() {
            if (window.scrollY > 50) {
              navbar.classList.add('shadow-elegant');
              navbar.style.backgroundColor = 'rgba(255, 255, 255, 0.98)';
            } else {
              navbar.classList.remove('shadow-elegant');
              navbar.style.backgroundColor = '';
            }
          });
        }

        // Mobile menu toggle
        const menuButton = document.querySelector('[data-collapse-toggle="navbar-main"]');
        const menu = document.getElementById('navbar-main');

        if (menuButton && menu) {
          menuButton.addEventListener('click', function() {
            menu.classList.toggle('hidden');
          });
        }

        // User dropdown toggle
        const dropdownButton = document.querySelector('[data-dropdown-toggle="user-dropdown"]');
        const dropdown = document.getElementById('user-dropdown');

        if (dropdownButton && dropdown) {
          dropdownButton.addEventListener('click', function(e) {
            e.stopPropagation();
            dropdown.classList.toggle('hidden');
          });

          document.addEventListener('click', function() {
            if (!dropdown.classList.contains('hidden')) {
              dropdown.classList.add('hidden');
            }
          });
        }

        // Smooth scroll for anchor links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
          anchor.addEventListener('click', function (e) {
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
              e.preventDefault();
              target.scrollIntoView({
                behavior: 'smooth',
                block: 'start'
              });
            }
          });
        });

        // Animate elements on scroll
        const observerOptions = {
          threshold: 0.1,
          rootMargin: '0px 0px -50px 0px'
        };

        const observer = new IntersectionObserver((entries) => {
          entries.forEach(entry => {
            if (entry.isIntersecting) {
              entry.target.classList.add('animate-fade-in-up');
              observer.unobserve(entry.target);
            }
          });
        }, observerOptions);

        document.querySelectorAll('.animate-on-scroll').forEach(el => {
          observer.observe(el);
        });
      });
    </script>

    <%= yield(:page_script) %>

    <% if params[:edit_mode] == 'true' %>
      <%= javascript_include_tag "pwb/editor_client" %>
    <% end %>
  </body>
</html>
